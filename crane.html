<!DOCTYPE html>
<html lang="fr">
<head>
  <title>Crane</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <meta charset="utf-8">
  <meta content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" name="viewport">
  <style>
    #canvas3d { position: absolute; width: 100%; height: 100%; left: 0; top: 0; color: hsl(210 100% 50%);border: 1px solid black}
  </style>
</head>
<body>
<div>
  <canvas id="canvas3d"></canvas>
</div>
<!-- Inlined textures -->
<img id="front" src="textures/front.jpg" style="display:none;" alt="front"/>
<img id="back" src="textures/back.jpg" style="display:none;" alt="back"/>
<!-- Main program -->
<script type="module">
  import {Model} from "./js/Model.js";
  import {View3d} from "./js/View3d.js";
  import {Command} from "./js/Command.js";
  import {Helper} from './js/Helper.js';

  init();

  function init() {
    // Model 3D
    const model = new Model().init(200, 200);

    // View 3d
    const canvas3d = window.document.getElementById("canvas3d");
    const view3d = new View3d(model, canvas3d);
    view3d.initBuffers();

    // Command
    const command = new Command(model);
    // Helper to handle mouse rotation and zoom
    new Helper(model, command, null, view3d, canvas3d);

    // Animation loop
    function loop() {
      if (command.anim()) {
        view3d.initBuffers();
        view3d.initModelView();
      }
      view3d.render();
      requestAnimationFrame(loop);
    }
    loop();

    //Test
    setTimeout( () => {
      command.command(`define 200 200
textures lines
// Crane
// Fold diagonals and median
by3d 1 3 offset -1 1 t 100 rotate 4 180 2
across3d 1 3 offset -1 0 1 t 100 rotate 6 180 1;
// Open
perpendicular3d 0 4
t 100 ty 45;
// Open front
t 500 r 13 -90 1 r 7 90 8 a 1;
t 500 r 13 -90 1 r 7 90 8 a 1;
t 500 rotate 5 -180 7;
// Open back
t 500 r 6 -90 6 r 9 90 3 a 3;
t 500 r 6 -90 6 r 9 90 3 a 3;
t 500 rotate 4 -180 6;
mop 0 1 2 3 mop 5 6 mop 8 7
// Crease
bisector3d 2 4
bisector3d 0 4
// Straighten
t 200 ty -45;
t 200 tz 45;
// Fold front
t 500 r 21 180 6 r 26 180 7;
t 500 r 21 -180 6 r 26 -180 7;
// Petal
by3d 9 12
t 1000 r 31 -180 2 a 6 7;
// Fold back
t 500 ty 180
t 500 r 19 -180 5 r 23 -180 8;
t 500 r 19 180 5 r 23 180 8;
// Petal
t 1000 r 29 -180 0 a 5 8;
t 200 ty 180
// Split
bisector3dPoints 12 1 15
bisector3dPoints 9 3 6
t 2000 rotate 41 180 11 rotate 41 -180 12;
t 2000 rotate 63 -180 9 rotate 63 180 10;

// Show
iao
t 1000 z 0.5;
t 1000 zf;
`);
    }, 500);
  }

</script>
</body>
</html>
